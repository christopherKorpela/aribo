<launch>

  <arg name="use_usb_cam" default="false" />
  <arg name="use_ptg_cam" default="false" />
  <arg name="use_gscam" default="false" />

  <include file="$(find rosbridge_server)/launch/rosbridge_websocket.launch"/>

  <node pkg="web_video_server" type="web_video_server" name="web_video_server" />

  <!-- <rosparam command="load" file="$(find usma_remote_interface)/config/gains.yaml" />

  <node pkg="usma_remote_interface" type="remoteCmdDemux.py" name="remote_cmd_demux" output="screen">
  </node>

  -->

  <group if="$(arg use_ptg_cam)">
    <include file="$(find pointgrey_camera_driver)/launch/camera.launch"/>
  </group>

  <group if="$(arg use_usb_cam)">
    <arg name="width" default="640" />
    <arg name="height" default="420" />
    <arg name="video_device" default="/dev/video0" />
  
    <node name="usb_cam" pkg="usb_cam" type="usb_cam_node" output="screen">
      <param name="video_device" value="$(arg video_device)" />
      <param name="image_width" value="$(arg width)" />
      <param name="image_height" value="$(arg height)" />
      <param name="pixel_format" value="yuyv" />
      <param name="camera_frame_id" value="usb_cam" />
      <param name="io_method" value="mmap"/>
    </node>

    <node name="image_view" pkg="image_view" type="image_view" respawn="false" output="screen">
      <remap from="image" to="/usb_cam/image_raw"/>
      <param name="autosize" value="true" />
    </node>
  </group>

  <group if="$(arg use_gscam)">
    <!-- Set this to your camera's name -->
    <arg name="cam_name" value="usb_cam" />

    !-- Start the GSCAM node -->
    <env name="GSCAM_CONFIG" value="v4l2src device=/dev/video0 ! video/x-raw-yuv,framerate=30/1,width=640,height=480 ! ffmpegcolorspace " />
    <node pkg="gscam" type="gscam" name="$(arg cam_name)">
      <param name="camera_name" value="$(arg cam_name)" />
      <param name="camera_info_url" value="package://localcam/calibrations/${NAME}.yaml" />
      <remap from="camera/image_raw" to="$(arg cam_name)/image_raw" />
    </node>

    <!-- Provide rectification -->
    <node pkg="image_proc" type="image_proc" name="creative_image_proc"
      ns="$(arg cam_name)" />

    <!-- View the raw and rectified output -->
    <node pkg="image_view" type="image_view" name="creative_view" >
      <remap from="image" to="/$(arg cam_name)/image_raw" />
    </node>
  
    <node pkg="image_view" type="image_view" name="creative_view_rect" >
      <remap from="image" to="/$(arg cam_name)/image_rect_color" />
    </node>
  </group>

</launch>
